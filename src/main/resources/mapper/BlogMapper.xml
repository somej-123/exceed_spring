<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.blog.exceed.mapper.BlogMapper">

  <insert id="insertBlogAttachment" parameterType="com.blog.exceed.dao.BlogAttachmentDao">
    INSERT INTO blog_attachment
      (blog_post_id, file_url, file_type, file_size, uploaded_at)
    VALUES
      (#{blogPostId}, #{fileUrl}, #{fileType}, #{fileSize}, now())
  </insert>

  <select id="selectAttachmentsByPostId" parameterType="long" resultType="com.blog.exceed.dao.BlogAttachmentDao">
    SELECT blog_attachment_id, blog_post_id, file_url, file_type, file_size, uploaded_at
    FROM blog_attachment
    WHERE blog_post_id = #{blogPostId}
    ORDER BY uploaded_at DESC
  </select>

  <insert id="insertBlogCategory" parameterType="com.blog.exceed.dao.BlogCategoryDao">
    INSERT INTO blog_category
      (name, description, created_at)
    VALUES
      (#{name}, #{description}, now())
  </insert>

  <select id="selectBlogCategories" resultType="com.blog.exceed.dao.BlogCategoryDao">
    SELECT blog_category_id, name, description, created_at
    FROM blog_category
    ORDER BY created_at DESC
  </select>

  <select id="selectBlogCategoriesPaged" resultType="com.blog.exceed.dao.BlogCategoryDao">
    SELECT blog_category_id, name, description, created_at
    FROM blog_category
    <where>
      <if test="search != null and search != ''">
        (LOWER(name) LIKE CONCAT('%', #{search}, '%')
        OR LOWER(description) LIKE CONCAT('%', #{search}, '%'))
      </if>
    </where>
    ORDER BY created_at DESC
    LIMIT #{size} OFFSET #{offset}
  </select>

  <select id="countBlogCategoriesPaged" resultType="int">
    SELECT COUNT(*)
    FROM blog_category
    <where>
      <if test="search != null and search != ''">
        (LOWER(name) LIKE CONCAT('%', #{search}, '%')
        OR LOWER(description) LIKE CONCAT('%', #{search}, '%'))
      </if>
    </where>
  </select>
</mapper> 